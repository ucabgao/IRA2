function getWeather(a,b){function c(){var c=JSON.parse(e.responseText);console.log(e.statusText),console.log(c);var d=c.state,f=c.county.basename,g=(c.county.name,document.getElementById("weatherIcon"));g.innerHTML="<img src='"+c.weather.icon+"' alt='Icon "+weather.description+"'></img>";var h=document.getElementById("weatherText");h.innerHTML=c.weather.city+", "+c.weather.state+"<br>",h.innerHTML+=c.county.name+"<br>",h.innerHTML+=a+", "+b+"<br>",h.innerHTML+=c.weather.description+" and "+c.weather.tempF+"°F<br>",null!==c.weather.precip&&(h.innerHTML+="Precip "+c.weather.precip+"<br>"),h.innerHTML+="Humiditity %"+c.weather.humidity+"<br>",h.innerHTML+="Wind "+c.weather.windDir+" at "+c.weather.windSpeed+" mph<br>",null!==c.weather.windChill&&c.weather.tempF<=40&&(h.innerHTML+="Wind Chill "+c.weather.windChill+"°F<br>"),null!==c.weather.heatIndex&&c.weather.tempF>=70&&(h.innnerHTML+="Heat Index "+c.weather.heatIndex+"°F<br>"),h.innerHTML+="Visibility "+c.weather.visibility+" mi<br>";var i=moment(c.weather.obsTime,"YYYY-MM-DD hh:mm am pm"),j=i.fromNow();h.innerHTML+="Updated "+j+"<br>",displayRadarImages(d);var k=c.alerts.length,l="#FF0000",m="#FF0000",n="#00FF00",o="#FF9900",p="#000000",q="#990099",r=[];if(document.getElementById("alerts").innerHTML="",0!==c.alerts.length){if(null!==c.alerts[0])for(var s=0;k>s;s++){var t=(c.alerts[s].alert.info[0].area[0],c.alerts[s].alert.info[0].area[0].polygon[0]),u=c.alerts[s].alert.info[0].area[0].areaDesc[0],v=(c.alerts[s].alert.msgType[0],c.alerts[s].alert.note[0],c.alerts[s].alert.scope[0],c.alerts[s].alert.sent[0],c.alerts[s].alert.status[0],c.alerts[s].alert.identifier[0]),w=c.alerts[s].alert.info[0].event[0],x=(c.alerts[s].alert.info[0].eventCode,p);-1!==w.search("Tornado")&&(x=l),-1!==w.search("Thunderstorm")&&(x=m),-1!==w.search("Flood")&&(x=n),-1!==w.search("Marine")&&(x=o),-1!==w.search("Wind")&&(x=q);for(var y=!1,z=0;z<r.length;z++)r[z]===v&&(y=!0);if(y===!1){var A=u.search(f);-1!==A&&(displayAlert(c.alerts[s]),r.push(v))}for(var B=0;"undefined"!=typeof c.alerts[s].alert.info[0].area[0].geocode[B];){if("UGC"===c.alerts[s].alert.info[0].area[0].geocode[B].valueName[0]){var C=c.alerts[s].alert.info[0].area[0].geocode[B].value[0],D=C.substr(0,2);D===c.state&&""!==t&&t.length>2&&drawPolygon(t,x)}B++}}c=null}else document.getElementById("alerts").innerHTML+="<p>All clear: there are no active watches, warnings or advisories for your location.</p>"}var d="https://dustyspringfield.airmanopus.net:8000?lat="+a+"&lon="+b,e=new XMLHttpRequest;e.addEventListener("load",c,!1),e.open("GET",d,!0),e.send()}function drawPolygon(a,b){var c=[];for(c[0]=a.split(" "),i=0;i<c[0].length;i++){var d=c[0][i].split(","),e=L.latLng(d[0],d[1]);c[0][i]=e}var f={color:b,weight:"4",opacity:"2",fill:"true",fillOpacity:"0.05",clickable:"false"};L.polyline(c[0],f).addTo(map)}function displayAlert(a){var b=(moment(a.alert.sent[0]),moment(a.alert.info[0].effective[0]).format("dddd hh:mm A")),c=moment(a.alert.info[0].expires[0]).format("dddd hh:mm A");console.log("displayAlert"+a.alert.info[0].event[0]),console.log(a.alert.identifier[0]),document.getElementById("alerts").innerHTML+="<pre>",document.getElementById("alerts").innerHTML+=a.alert.info[0].event[0]+"<br>",say(a.alert.info[0].event[0]),document.getElementById("alerts").innerHTML+="Effective beginning "+b+" until "+c+"<br>",document.getElementById("alerts").innerHTML+=a.alert.info[0].senderName[0]+"<br>",document.getElementById("alerts").innerHTML+="Areas affected include "+a.alert.info[0].area[0].areaDesc[0]+"<br>",document.getElementById("alerts").innerHTML+=a.alert.info[0].description[0]+"<br>",(void 0!==typeof a.alert.note[0]||""===a.alert.note[0])&&(document.getElementById("alerts").innerHTML+=a.alert.note[0]+"<br>"),void 0!==a.alert.info[0].instruction&&""!==a.alert.info[0].instruction[0]&&(document.getElementById("alerts").innerHTML+=a.alert.info[0].instruction[0]+"<br>"),document.getElementById("alerts").innerHTML+="</pre>"}function displayRadarImages(a){function b(){function a(){for(var a,b,c,d,f,g,h=(e.statusText,e.responseXML),i=h.getElementsByTagName("href"),j=i.length,k=[],l=0;j>l;l++)a=h.getElementsByTagName("href")[l].textContent,c=h.getElementsByTagName("north")[l].textContent,d=h.getElementsByTagName("south")[l].textContent,f=h.getElementsByTagName("east")[l].textContent,g=h.getElementsByTagName("west")[l].textContent,k=[[d,g],[c,f]],b=L.imageOverlay(a,k),map.addLayer(b)}function b(){console.log("error")}thisState=arguments[0];var c=["CT","NH","RI"];for(k=0;k<c.length;k++)if(thisState===c[k])return;var d="https://www.airmanopus.net/weathercheck/kml/"+thisState+"_Radar_data.kml",e=new XMLHttpRequest;e.addEventListener("load",a,!1),e.addEventListener("error",b,!1),e.open("GET",d,!0),e.send()}var c=(arguments[0],arguments[1],{AK:[" "],AL:["FL","GA","MS","TN"],AR:["LA","MO","MS","OK","TN","TX"],AZ:["CA","CO","NM","NV","UT"],CA:["NV","OR"],CO:["KS","NE","NM","OK","UT","WY"],CT:["MA","NY","RI"],DC:["MD","VA"],DE:["MD","NJ","PA"],FL:["AL","GA"],GA:["NC","SC","TN","FL"],HI:[" "],IA:["IL","MN","MO","NE","SD","WI"],ID:["MT","NV","OR","UT","WA","WY"],IL:["IN","KY","MO","WI"],IN:["KY","MI","OH"],KS:["CO","MO","NE","OK"],KY:["MO","OH","TN","VA","WV"],LA:["AR","MS","TX"],MA:["CT","NH","NY","RI","VT"],MD:["DC","PA","VA","WV"],ME:["NH"],MI:["IN","OH","WI"],MN:["IA","ND","SD","WI"],MO:["AR","IA","IL","KS","KY","NE","OK","TN"],MS:["LA","AR","TN","AL"],MT:["ID","ND","SD","NE","WY"],NC:["SC","TN","VA"],ND:["MN","SD","MT"],NE:["CO","IA","KS","MO","SD","WY"],NH:["VT","ME","MA"],NJ:["DE","PA","NY"],NM:["AZ","UT","CO","OK","TX"],NV:["CA","AZ","UT","ID","OR"],NY:["OH","MA","PA","CA"],OH:["IN","MI","PA","KY","WV"],OK:["AK","TX","NM","CO","KS","MO"],OR:["WA","ID","NV","CA"],PA:["OH","WV","MD","NJ","NY"],RI:["CT","MA","NY"],SC:["GA","NC"],SD:["ND","IA","NE","MN","MT","WY"],TN:["AK","MS","AL","GA","NC","VA","MO","AR"],TX:["NM","OK","AR","LA"],UT:["CO","NM","AZ","NV","ID","WY"],VA:["NC","KY","WV","MD"],WA:["ID","OR"],WV:["OH","PA","MD","KY"],WI:["IA","IL","MN","MI"],WY:["MT","SD","NE","CO","UT","ID"]}),d=[];d=c[a],d.push(a);for(var e=0;e<d.length;e++)b(d[e])}function say(){if(void 0!==window.speechSynthesis){var a=arguments[0],b=1.7,c=1.5,d=1,e=new SpeechSynthesisUtterance(a);e.volume=d,e.rate=c,e.pitch=b,window.speechSynthesis.speak(e)}}function initialize(){var a,b;navigator.geolocation&&navigator.geolocation.watchPosition(function(c){mapFirstDraw&&(a=c.coords.latitude,b=c.coords.longitude,map=L.mapbox.map("map","airmanopus.hm9c0o4f",{center:[a,b],zoom:11,inertia:!0,watch:!0,enableHighAccuracy:!1,maximumAge:25e3,trackResize:!0,attributionControl:!0,setView:!0}),L.marker([a,b]).addTo(map),mapFirstDraw=!1),a=c.coords.latitude.toPrecision(6),b=c.coords.longitude.toPrecision(6),console.log("location updated to "+a+","+b),map.setView([a,b]),getWeather(a,b)})}function success(a){console.log("Geolocation! YAY!")}function error(a){document.getElementById("weather").innnerHTML="Unable to determine your location, error "+a.code,document.getElementById("weather").innerHTML+="You may need to enable geolocation on your device."}var mapFirstDraw=!0,map;navigator.geolocation?navigator.geolocation.getCurrentPosition(success,error):error("Please enable location services.");